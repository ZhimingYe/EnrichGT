---
title: "Clustering and viewing ORA results"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Clustering and viewing ORA results}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(EnrichGT)
```

# Summary

For overexpression enrichment analysis (What is overexpression enrichment analysis? See webpage: <https://yulab-smu.top/biomedical-knowledge-mining-book/enrichment-overview.html>), EnrichGT can read results from `enrichResult` generated by `clusterProfiler` or an exported table from clusterProfiler enrichment (including at least the columns “ID”, “Description”, “GeneRatio”, “pvalue”, “p.adjust”, “geneID” and “Count”). `EnrichGT` performs term frequency statistics and automatic clustering based on genes enriched in hits, returns an S4 object, and outputs a beautifully formatted result wrapped by gt.

# Generating enriched Result

```{r}
suppressMessages({
  library(tidyverse)
  library(gt)
  library(clusterProfiler)
  library(org.Hs.eg.db)
  })
data(geneList, package="DOSE")
gene <- names(geneList)[abs(geneList) > 2]
ego <- enrichGO(gene          = gene,
                  universe      = names(geneList),
                  OrgDb         = org.Hs.eg.db,
                  ont           = "BP",
                  pAdjustMethod = "BH",
                  pvalueCutoff  = 0.5,
                  qvalueCutoff  = 0.5,
                  readable      = TRUE)
```

# go EnrichGT!

## From `enrichResult` object

### Do enriching

```{r}
ego
```

```{r, fig.width=7,fig.height=7}
obj <- ego |> EnrichGT(P.adj = 0.2,ClusterNum = 10,nTop = 10)
```

You can define how many clusters and how many top terms would be shown. And you can adjust the p-adj cut-off.

### Understanding `EnrichGT_obj`


The created `obj` contains several slots:

```{r}
str(obj,max.level=2)
```

Simply enter `obj` in console also can returns a rendered gt view in `viewer` plane in RStudio.

``` r
obj
```

`gt` object is storaged in `gt_object`. You can use all `gt` functions on it like gt::gtsave() by calling `obj@gt_object`.

```{r}
obj@gt_object
```

Full enriched enriched (enrich^2) result is in `obj@enriched_result`. 

```{r}
df1<-obj@enriched_result |> as_tibble()
df1
```

We also generated gene modules and pathway clusters based on clustering results. You can assess them by `obj@gene_modules` and `obj@pathway_clusters`. 

```{r}
head(obj@gene_modules)
```

## From saved data frame

We can parse any data frame saved from clusterProfiler on disk, for re-producing results. Like this: 

### Save data frame

```{r}
write.csv(ego,"ego_enriched.csv")
```

```{r}
res0<-read_csv("ego_enriched.csv")
res0
```

### do EnrichGT

```{r, fig.width=7,fig.height=7}
obj1<-res0|> EnrichGT(P.adj = 0.2,ClusterNum = 10,nTop = 10)
```

```{r}
obj@gt_object
```

# Visualize

## Dot Plot

```{r fig.height=9, fig.width=7}
egtPlot(obj)
```

## UMAP visualization

```{r fig.height=7, fig.width=7}
egtScatter(obj)
```

# Session info

```{r}
sessioninfo::session_info()
```

